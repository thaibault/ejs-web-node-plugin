'use strict';
(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b(require('babel-runtime/helpers/asyncToGenerator'),require('babel-runtime/core-js/object/values'),require('babel-runtime/core-js/object/keys'),require('babel-runtime/core-js/get-iterator'),require('babel-runtime/core-js/promise'),require('babel-runtime/regenerator'),require('babel-runtime/helpers/classCallCheck'),require('clientnode'),require('ejs'),require('fs'),require('path'),require('web-node/pluginAPI.compiled'),function(){try{return require('source-map-support/register')}catch(a){}}()):'function'==typeof define&&define.amd?define('templatewebnodeplugin',['babel-runtime/helpers/asyncToGenerator','babel-runtime/core-js/object/values','babel-runtime/core-js/object/keys','babel-runtime/core-js/get-iterator','babel-runtime/core-js/promise','babel-runtime/regenerator','babel-runtime/helpers/classCallCheck','clientnode','ejs','fs','path','web-node/pluginAPI.compiled','source-map-support/register'],b):'object'==typeof exports?exports.templatewebnodeplugin=b(require('babel-runtime/helpers/asyncToGenerator'),require('babel-runtime/core-js/object/values'),require('babel-runtime/core-js/object/keys'),require('babel-runtime/core-js/get-iterator'),require('babel-runtime/core-js/promise'),require('babel-runtime/regenerator'),require('babel-runtime/helpers/classCallCheck'),require('clientnode'),require('ejs'),require('fs'),require('path'),require('web-node/pluginAPI.compiled'),function(){try{return require('source-map-support/register')}catch(a){}}()):a.templatewebnodeplugin=b(a['babel-runtime/helpers/asyncToGenerator'],a['babel-runtime/core-js/object/values'],a['babel-runtime/core-js/object/keys'],a['babel-runtime/core-js/get-iterator'],a['babel-runtime/core-js/promise'],a['babel-runtime/regenerator'],a['babel-runtime/helpers/classCallCheck'],a.clientnode,a.ejs,a.fs,a.path,a['web-node/pluginAPI.compiled'],a['source-map-support/register'])})('undefined'==typeof self?this:self,function(a,b,c,d,e,f,g,h,i,j,k,l,m){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)}([function(a,b,c){a.exports=c(1)},function(a,b,c){'use strict';(function(a,d){function e(a){return a&&a.__esModule?a:{default:a}}var f=c(3),g=e(f),h=c(4),i=e(h),j=c(5),k=e(j),l=c(6),m=e(l),n=c(7),o=e(n),p=c(8),q=e(p),r=c(9),s=e(r),t=c(10),u=e(t),v=c(11),w=e(v),x=c(12),y=e(x),z=c(13),A=e(z),B=c(14),C=e(B);b.__esModule=!0,b.Template=void 0;try{c(15)}catch(a){}var D=b.Template=function(){function b(){(0,s.default)(this,b)}return b.postConfigurationLoaded=function(){var a=(0,q.default)(o.default.mark(function a(c,d,e,f){return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c.template.renderAfterConfigurationUpdates&&b.render(null,c,f),a.abrupt('return',c);case 2:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.preLoadService=function(a){return a.template={render:b.render.bind(b),renderFactory:b.renderFactory.bind(b)},a},b.shouldExit=function(){var a=(0,q.default)(o.default.mark(function a(c,d){var e,f,g,h=this;return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(g in e=[],f=function(a){b.files.hasOwnProperty(a)&&!d.template.inPlaceReplacementPaths.includes(a)&&e.push(new m.default(function(){var b=(0,q.default)(o.default.mark(function b(c,d){var e,f;return o.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return e=a.substring(0,a.length-A.default.extname(a).length),f=!1,b.prev=2,b.next=5,u.default.isFile(e);case 5:f=b.sent,b.next=11;break;case 8:b.prev=8,b.t0=b['catch'](2),d(b.t0);case 11:f?y.default.unlink(e,function(a){return a?d(a):c(e)}):c(f);case 12:case'end':return b.stop();}},b,h,[[2,8]])}));return function(){return b.apply(this,arguments)}}()))},b.files)f(g);return a.next=5,m.default.all(e);case 5:return a.abrupt('return',c);case 6:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.getEntryFiles=function(){var a=(0,q.default)(o.default.mark(function a(c,d){var e,f,g,h,i,j,l,m,n,p,q,r;return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!b.entryFiles||c.template.reloadEntryFiles){a.next=2;break}return a.abrupt('return',b.entryFiles);case 2:return e=d.map(function(a){return a.path}),b.entryFiles={},a.next=6,u.default.walkDirectoryRecursively(c.context.path,function(a){if(a.name.startsWith('.'))return!1;for(var b in c.plugin.directories)if(c.plugin.directories.hasOwnProperty(b)&&A.default.dirname(a.path)===A.default.resolve(c.plugin.directories[b].path)&&!e.includes(a.path))return!1;for(var d=c.template.locationsToIgnore,f=Array.isArray(d),g=0,d=f?d:(0,k.default)(d);;){var h;if(f){if(g>=d.length)break;h=d[g++]}else{if(g=d.next(),g.done)break;h=g.value}var i=h;if(!i.startsWith('/'))for(var j=e,l=Array.isArray(j),m=0,j=l?j:(0,k.default)(j);;){var n;if(l){if(m>=j.length)break;n=j[m++]}else{if(m=j.next(),m.done)break;n=m.value}var o=n;if(a.path.startsWith(A.default.resolve(o,i)))return!1}else if(a.path.startsWith(A.default.join(c.context.path,i)))return!1}});case 6:a.t0=function(a){return a.stats&&a.stats.isFile()&&0<c.template.extensions.filter(function(b){return a.name.endsWith(b)}).length},f=a.sent.filter(a.t0),g=Array.isArray(f),h=0,f=g?f:(0,k.default)(f);case 11:if(!g){a.next=17;break}if(!(h>=f.length)){a.next=14;break}return a.abrupt('break',25);case 14:i=f[h++],a.next=21;break;case 17:if(h=f.next(),!h.done){a.next=20;break}return a.abrupt('break',25);case 20:i=h.value;case 21:j=i,b.entryFiles[j.path]=null;case 23:a.next=11;break;case 25:l=c.template.inPlaceReplacementPaths,m=Array.isArray(l),n=0,l=m?l:(0,k.default)(l);case 26:if(!m){a.next=32;break}if(!(n>=l.length)){a.next=29;break}return a.abrupt('break',40);case 29:p=l[n++],a.next=36;break;case 32:if(n=l.next(),!n.done){a.next=35;break}return a.abrupt('break',40);case 35:p=n.value;case 36:q=p,b.entryFiles[q]=null;case 38:a.next=26;break;case 40:for(r in b.entryFiles)b.entryFiles.hasOwnProperty(r)&&(b.files[r]=b.entryFiles[r]);return a.abrupt('return',b.entryFiles);case 42:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.render=function(){function c(){return e.apply(this,arguments)}var e=(0,q.default)(o.default.mark(function c(e,f,h){var j,k,l,n,p,r,s,t,v,x,z=this;return o.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:for(j=u.default.extendObject(!0,{basePath:f.context.path},f.template.scope.plain,e||{}),k=['evaluation','execution'],l=0;l<k.length;l++)for(p in n=k[l],f.template.scope[n])f.template.scope[n].hasOwnProperty(p)&&(r={configuration:u.default.copyLimitedRecursively(f,-1,!0),currentPath:a.cwd(),fileSystem:y.default,parser:w.default,path:A.default,PluginAPI:C.default,plugins:h,require:eval('require'),scope:j,template:b,Tools:u.default,webNodePath:d},j[p]=new(Function.prototype.bind.apply(Function,[null].concat((0,i.default)(r),['evaluation'===n?'return '+f.template.scope[n][p]:f.template.scope[n][p]])))().apply(void 0,(0,g.default)(r)));return s=u.default.copyLimitedRecursively(f.template.options),j.include=b.renderFactory(f,j,s),c.t0=C.default,c.t1=h,c.t2=f,c.next=10,b.getEntryFiles(f,h);case 10:return c.t3=c.sent,c.t4=j,c.next=14,c.t0.callStack.call(c.t0,'preTemplateRender',c.t1,c.t2,c.t3,c.t4);case 14:for(x in b.entryFiles=c.sent,t=[],v=function(a){b.entryFiles.hasOwnProperty(a)&&t.push(new m.default(function(){var c=(0,q.default)(o.default.mark(function c(d,e){var g,i,k,l,m;return o.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(g=u.default.extendObject({},j),i=f.template.inPlaceReplacementPaths.includes(a),k=i?a:a.substring(0,a.length-A.default.extname(a).length),c.t0=i&&f.template.cacheInPlaceReplacements&&b.entryFiles[a],c.t0){c.next=11;break}if(c.t1=!i&&f.template.cache,!c.t1){c.next=10;break}return c.next=9,u.default.isFile(k);case 9:c.t1=c.sent;case 10:c.t0=c.t1;case 11:if(!c.t0){c.next=16;break}console.info('Template: Use cached file ("'+k+'") '+('for "'+a+'".')),d(k),c.next=21;break;case 16:if(l=u.default.extendObject({},s,{filename:A.default.relative(g.basePath,a)}),'options'in g||(g.options=l),'plugins'in g||(g.plugins=h),m=b.renderFactory(f,g,l)(a),m)try{y.default.writeFile(k,m,{encoding:f.encoding,flag:'w',mode:438},function(a){return a?e(a):d(k)})}catch(a){e(a)}else console.warn('An empty template processing result detected for file "'+k+'" with in '+('put file "'+a+'".')),d(k);case 21:case'end':return c.stop();}},c,z)}));return function(){return c.apply(this,arguments)}}()))},b.entryFiles)v(x);return c.next=20,m.default.all(t);case 20:return c.next=22,C.default.callStack('postTemplateRender',h,f,j,b.entryFiles);case 22:return c.abrupt('return',c.sent);case 23:case'end':return c.stop();}},c,this)}));return c}(),b.renderFactory=function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return c.basePath||(c.basePath=a.context.path),d.preCompiledTemplateFileExtensions||(d.preCompiledTemplateFileExtensions=['.js']),function(e){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},g=u.default.copyLimitedRecursively(d);delete g.client,g=u.default.extendObject(!0,{encoding:'utf-8'},g,f.options||{});var h=u.default.extendObject({},c);e=A.default.resolve(c.basePath,e),g.filename=A.default.relative(c.basePath,e),h.basePath=A.default.dirname(e),h.include=b.renderFactory(a,h,g),h.options=g,h.scope=h,u.default.extendObject(h,f);for(var i=null,j=[''].concat(a.template.extensions),l=Array.isArray(j),m=0,j=l?j:(0,k.default)(j);;){var n;if(l){if(m>=j.length)break;n=j[m++]}else{if(m=j.next(),m.done)break;n=m.value}var o=n;if(u.default.isFileSync(e+o)){i=e+o;break}}if(i){if(a.template.reloadSourceContent&&!a.template.inPlaceReplacementPaths.includes(e)||!(b.files.hasOwnProperty(i)&&b.files[i]))if(g.preCompiledTemplateFileExtensions.includes(A.default.extname(i)))try{b.files[i]=eval('require')(i)}catch(a){throw new Error('Error occurred during loading script module: "'+i+'": '+u.default.representObject(a))}else{var p;try{p=y.default.readFileSync(i,{encoding:g.encoding})}catch(a){throw new Error('Error occurred during loading template file "'+i+'" from file system:'+(' '+u.default.representObject(a)))}try{b.files[i]=w.default.compile(p,g)}catch(a){throw new Error('Error occurred during compiling template file "'+i+'" with base path "'+(h.basePath+'": ')+u.default.representObject(a))}}var q='';try{q=b.files[i](h)}catch(a){var r='';try{r='scope '+u.default.representObject(h)+' against'}catch(a){}throw new Error('Error occurred during running template '+(r+'file "'+i+'": ')+u.default.representObject(a))}return q.replace(/<script +processing-workaround *(?:= *(?:" *"|' *') *)?>([\s\S]*?)<\/ *script *>/ig,'$1').replace(/<script +processing(-+)-workaround *(?:= *(?:" *"|' *') *)?>([\s\S]*?)<\/ *script *>/ig,'<script processing$1workaround>$2</script>')}throw new Error('Given template file "'+g.filename+'" couldn\'t be resolved (with known extensions: "'+(a.template.extensions.join('", "')+'") in "')+(c.basePath+'".'))}},b}();D.files={},b.default=D}).call(b,c(2),'/')},function(a){function b(){throw new Error('setTimeout has not been defined')}function c(){throw new Error('clearTimeout has not been defined')}function d(a){if(j===setTimeout)return setTimeout(a,0);if((j===b||!j)&&setTimeout)return j=setTimeout,setTimeout(a,0);try{return j(a,0)}catch(b){try{return j.call(null,a,0)}catch(b){return j.call(this,a,0)}}}function e(a){if(k===clearTimeout)return clearTimeout(a);if((k===c||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(a);try{return k(a)}catch(b){try{return k.call(null,a)}catch(b){return k.call(this,a)}}}function f(){o&&m&&(o=!1,m.length?n=m.concat(n):p=-1,n.length&&g())}function g(){if(!o){var a=d(f);o=!0;for(var b=n.length;b;){for(m=n,n=[];++p<b;)m&&m[p].run();p=-1,b=n.length}m=null,o=!1,e(a)}}function h(a,b){this.fun=a,this.array=b}function i(){}var j,k,l=a.exports={};(function(){try{j='function'==typeof setTimeout?setTimeout:b}catch(a){j=b}try{k='function'==typeof clearTimeout?clearTimeout:c}catch(a){k=c}})();var m,n=[],o=!1,p=-1;l.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];n.push(new h(a,b)),1!==n.length||o||d(g)},h.prototype.run=function(){this.fun.apply(null,this.array)},l.title='browser',l.browser=!0,l.env={},l.argv=[],l.version='',l.versions={},l.on=i,l.addListener=i,l.once=i,l.off=i,l.removeListener=i,l.removeAllListeners=i,l.emit=i,l.prependListener=i,l.prependOnceListener=i,l.listeners=function(){return[]},l.binding=function(){throw new Error('process.binding is not supported')},l.cwd=function(){return'/'},l.chdir=function(){throw new Error('process.chdir is not supported')},l.umask=function(){return 0}},function(a){a.exports=b},function(a){a.exports=c},function(a){a.exports=d},function(a){a.exports=e},function(a){a.exports=f},function(b){b.exports=a},function(a){a.exports=g},function(a){a.exports=h},function(a){a.exports=i},function(a){a.exports=j},function(a){a.exports=k},function(a){a.exports=l},function(a){if('undefined'==typeof m){var b=new Error('Cannot find module "source-map-support/register"');throw b.code='MODULE_NOT_FOUND',b}a.exports=m}])});